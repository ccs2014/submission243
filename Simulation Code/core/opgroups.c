/*care:    (pc, ci, op, op1, op2, mr)
rescare: (pc, op3, mw)
12m  p3m
*/

#include <stdio.h>
#include <string.h>

struct isa {
    char *str;
    unsigned int opgrp;
    unsigned int care;
    unsigned int rescare;
};

struct isa dict[] = {	/* 338 */
    {"addl", 			1,	0x3e,	0x6},
    {"addlimm", 		2,	0x3c,	0x6},
    {"addlv", 			1,	0x3e,	0x6},
    {"addlvimm", 		2,	0x3c,	0x6},
    {"addq", 			1,	0x3e,	0x6},
    {"addqimm", 		2,	0x3c,	0x6},
    {"addqv", 			1,	0x3e,	0x6},
    {"addqvimm", 		2,	0x3c,	0x6},
    {"adds", 			1,	0x3e,	0x6},
    {"adds/su", 		1,	0x3e,	0x6},
    {"adds/sud", 		1,	0x3e,	0x6},
    {"adds/sum", 		1,	0x3e,	0x6},
    {"addt", 			1,	0x3e,	0x6},
    {"addt/sud", 		1,	0x3e,	0x6},
    {"addt/sum", 		1,	0x3e,	0x6},
    {"amask", 			1,	0x3e,	0x6},
    {"amaskimm", 		2,	0x3c,	0x6},
    {"and", 			1,	0x3e,	0x6},
    {"andimm", 			2,	0x3c,	0x6},
    {"arm", 			20,	0x38,	0x4},
    {"beq", 			4,	0x3c,	0x4},
    {"bge", 			4,	0x3c,	0x4},
    {"bgt", 			4,	0x3c,	0x4},
    {"bic", 			1,	0x3e,	0x6},
    {"bicimm", 			2,	0x3c,	0x6},
    {"bis", 			1,	0x3e,	0x6},
    {"bisimm", 			2,	0x3c,	0x6},
    {"blbc", 			4,	0x3c,	0x4},
    {"blbs", 			4,	0x3c,	0x4},
    {"ble", 			4,	0x3c,	0x4},
    {"blt", 			4,	0x3c,	0x4},
    {"bne", 			4,	0x3c,	0x4},
    {"br", 			5,	0x38,	0x4},
    {"brandlink", 		5,	0x38,	0x4},
    {"bsr", 			7,	0x3c,	0x6},
    {"bsrandlink", 		7,	0x3c,	0x6},
    {"call_pal", 		7,	0x3c,	0x6},
    {"callsys", 		7,	0x3c,	0x6},
    {"cmoveq", 			12,	0x3e,	0x6},
    {"cmoveqimm", 		2,	0x3c,	0x6},
    {"cmovge", 			12,	0x3e,	0x6},
    {"cmovgeimm", 		2,	0x3c,	0x6},
    {"cmovgt", 			12,	0x3e,	0x6},
    {"cmovgtimm", 		2,	0x3c,	0x6},
    {"cmovlbc", 		12,	0x3e,	0x6},
    {"cmovlbcimm", 		2,	0x3c,	0x6},
    {"cmovlbs", 		12,	0x3e,	0x6},
    {"cmovlbsimm", 		2,	0x3c,	0x6},
    {"cmovle", 			12,	0x3e,	0x6},
    {"cmovleimm", 		2,	0x3c,	0x6},
    {"cmovlt", 			12,	0x3e,	0x6},
    {"cmovltimm", 		2,	0x3c,	0x6},
    {"cmovne", 			12,	0x3e,	0x6},
    {"cmovneimm", 		2,	0x3c,	0x6},
    {"cmpbge", 			1,	0x3e,	0x6},
    {"cmpbgeimm", 		2,	0x3c,	0x6},
    {"cmpeq", 			1,	0x3e,	0x6},
    {"cmpeqimm", 		2,	0x3c,	0x6},
    {"cmple", 			1,	0x3e,	0x6},
    {"cmpleimm", 		2,	0x3c,	0x6},
    {"cmplt", 			1,	0x3e,	0x6},
    {"cmpltimm", 		2,	0x3c,	0x6},
    {"cmpteq", 			1,	0x3e,	0x6},
    {"cmptle", 			1,	0x3e,	0x6},
    {"cmptlt", 			1,	0x3e,	0x6},
    {"cmptun", 			1,	0x3e,	0x6},
    {"cmpule", 			1,	0x3e,	0x6},
    {"cmpuleimm", 		2,	0x3c,	0x6},
    {"cmpult", 			1,	0x3e,	0x6},
    {"cmpultimm", 		2,	0x3c,	0x6},
    {"cpys", 			1,	0x3e,	0x6},
    {"cpyse", 			1,	0x3e,	0x6},
    {"cpysn", 			1,	0x3e,	0x6},
    {"ctlz", 			1,	0x3e,	0x6},
    {"ctpop", 			1,	0x3e,	0x6},
    {"cttz", 			1,	0x3e,	0x6},
    {"cvtlq", 			2,	0x3c,	0x6},
    {"cvtql", 			2,	0x3c,	0x6},
    {"cvtqlv", 			2,	0x3c,	0x6},
    {"cvtqs", 			2,	0x3c,	0x6},
    {"cvtqs/d",			2,	0x3c,	0x6},
    {"cvtqt", 			2,	0x3c,	0x6},
    {"cvtqt/d",			2,	0x3c,	0x6},
    {"cvtst", 			2,	0x3c,	0x6},
    {"cvttq", 			2,	0x3c,	0x6},
    {"cvttq/c", 		2,	0x3c,	0x6},
    {"cvttq/suc", 		2,	0x3c,	0x6},
    {"cvttqchopped", 		2,	0x3c,	0x6},
    {"cvttqminusinfinity",	2,	0x3c,	0x6},
    {"cvtts", 			2,	0x3c,	0x6},
    {"deprecated_exit",		20,	0x38,	0x6},
    {"deprecated_ivlb",		20,	0x38,	0x6},
    {"deprecated_ivle",		20,	0x38,	0x6},
    {"divs", 			1,	0x3e,	0x6},
    {"divs/sud", 		1,	0x3e,	0x6},
    {"divt", 			1,	0x3e,	0x6},
    {"divt/c", 			1,	0x3e,	0x6},
    {"divt/su", 		1,	0x3e,	0x6},
    {"divt/sud", 		1,	0x3e,	0x6},
    {"dumpresetstats", 		20,	0x38,	0x6},
    {"dumpstats", 		20,	0x38,	0x6},
    {"eqv", 			1,	0x3e,	0x6},
    {"eqvimm", 			2,	0x3c,	0x6},
    {"excb", 			1,	0x3e,	0x6},
    {"extbl", 			1,	0x3e,	0x6},
    {"extblimm", 		2,	0x3c,	0x6},
    {"extlh", 			1,	0x3e,	0x6},
    {"extlhimm", 		2,	0x3c,	0x6},
    {"extll", 			1,	0x3e,	0x6},
    {"extllimm", 		2,	0x3c,	0x6},
    {"extqh", 			1,	0x3e,	0x6},
    {"extqhimm", 		2,	0x3c,	0x6},
    {"extql", 			1,	0x3e,	0x6},
    {"extqlimm", 		2,	0x3c,	0x6},
    {"extwh", 			1,	0x3e,	0x6},
    {"extwhimm", 		2,	0x3c,	0x6},
    {"extwl", 			1,	0x3e,	0x6},
    {"extwlimm", 		2,	0x3c,	0x6},
    {"fbeq", 			4,	0x3c,	0x4},
    {"fbge", 			4,	0x3c,	0x4},
    {"fbgt", 			4,	0x3c,	0x4},
    {"fble", 			4,	0x3c,	0x4},
    {"fblt", 			4,	0x3c,	0x4},
    {"fbne", 			4,	0x3c,	0x4},
    {"fcmoveq", 		12,	0x3e,	0x6},
    {"fcmovge", 		12,	0x3e,	0x6},
    {"fcmovgt", 		12,	0x3e,	0x6},
    {"fcmovle", 		12,	0x3e,	0x6},
    {"fcmovlt", 		12,	0x3e,	0x6},
    {"fcmovne", 		12,	0x3e,	0x6},
    {"ftois", 			1,	0x3e,	0x6},
    {"ftoit", 			1,	0x3e,	0x6},
    {"halt", 			20,	0x38,	0x4},
    {"hw_ldl", 			19,	0x38,	0x4},
    {"hw_ldq", 			19,	0x38,	0x4},
    {"hw_mfpr", 		19,	0x38,	0x4},
    {"hw_mtpr", 		19,	0x38,	0x4},
    {"hw_rei", 			19,	0x38,	0x4},
    {"hw_stl", 			18,	0x38,	0x4},
    {"hw_stq", 			18,	0x38,	0x4},
    {"implver", 		15,	0x38,	0x4},
    {"initparam", 		15,	0x38,	0x4},
    {"insbl", 			1,	0x3e,	0x6},
    {"insblimm", 		2,	0x3c,	0x6},
    {"inslh", 			1,	0x3e,	0x6},
    {"inslhimm", 		2,	0x3c,	0x6},
    {"insll", 			1,	0x3e,	0x6},
    {"insllimm", 		2,	0x3c,	0x6},
    {"insqh", 			1,	0x3e,	0x6},
    {"insqhimm", 		2,	0x3c,	0x6},
    {"insql", 			1,	0x3e,	0x6},
    {"insqlimm", 		2,	0x3c,	0x6},
    {"inswh", 			1,	0x3e,	0x6},
    {"inswhimm", 		2,	0x3c,	0x6},
    {"inswl", 			1,	0x3e,	0x6},
    {"inswlimm", 		2,	0x3c,	0x6},
    {"itofs", 			2,	0x3c,	0x6},
    {"itoft", 			2,	0x3c,	0x6},
    {"jmp", 			6,	0x38,	0x4},
    {"jmpandlink", 		6,	0x38,	0x4},
    {"jsr", 			8,	0x3c,	0x6},
    {"jsr_coroutine", 		8,	0x3c,	0x6},
    {"jsr_coroutineandlink",	8,	0x3c,	0x6},
    {"jsrandlink", 		8,	0x3c,	0x6},
    {"lda", 			2,	0x3c,	0x6},
    {"ldah", 			2,	0x3c,	0x6},
    {"ldbu", 			10,	0x3d,	0x6},
    {"ldl", 			10,	0x3d,	0x6},
    {"ldl_l", 			10,	0x3d,	0x6},
    {"ldlprefetch", 		10,	0x3d,	0x6},
    {"ldq", 			10,	0x3d,	0x6},
    {"ldq_l", 			10,	0x3d,	0x6},
    {"ldq_u", 			10,	0x3d,	0x6},
    {"ldqprefetch", 		10,	0x3d,	0x6},
    {"lds", 			10,	0x3d,	0x6},
    {"ldsprefetch", 		10,	0x3d,	0x6},
    {"ldt", 			10,	0x3d,	0x6},
    {"ldwu", 			10,	0x3d,	0x6},
    {"loadsymbol", 		10,	0x3d,	0x4},
    {"m5a_aq", 			16,	0x38,	0x4},
    {"m5a_begin", 		16,	0x38,	0x4},
    {"m5a_bsm", 		16,	0x38,	0x4},
    {"m5a_dq", 			16,	0x38,	0x4},
    {"m5a_end", 		16,	0x38,	0x4},
    {"m5a_esm", 		16,	0x38,	0x4},
    {"m5a_getid", 		16,	0x38,	0x4},
    {"m5a_identify", 		16,	0x38,	0x4},
    {"m5a_l", 			16,	0x38,	0x4},
    {"m5a_old", 		16,	0x38,	0x4},
    {"m5a_pq", 			16,	0x38,	0x4},
    {"m5a_q", 			16,	0x38,	0x4},
    {"m5a_rq", 			16,	0x38,	0x4},
    {"m5a_scl", 		16,	0x38,	0x4},
    {"m5a_sq", 			16,	0x38,	0x4},
    {"m5a_we", 			16,	0x38,	0x4},
    {"m5a_wf", 			16,	0x38,	0x4},
    {"m5addsymbol", 		16,	0x38,	0x4},
    {"m5break", 		16,	0x38,	0x4},
    {"m5checkpoint", 		16,	0x38,	0x4},
    {"m5exit", 			16,	0x38,	0x4},
    {"m5panic", 		16,	0x38,	0x4},
    {"m5readfile", 		16,	0x38,	0x4},
    {"m5reserved2", 		16,	0x38,	0x4},
    {"m5reserved3", 		16,	0x38,	0x4},
    {"m5reserved4", 		16,	0x38,	0x4},
    {"m5reserved5", 		16,	0x38,	0x4},
    {"m5switchcpu", 		16,	0x38,	0x4},
    {"maxsb8", 			2,	0x3c,	0x6},
    {"maxsw4", 			2,	0x3c,	0x6},
    {"maxub8", 			2,	0x3c,	0x6},
    {"maxuw4", 			2,	0x3c,	0x6},
    {"mb", 			2,	0x3c,	0x6},
    {"mf_fpcr", 		16,	0x38,	0x4},
    {"minsb8", 			2,	0x3c,	0x6},
    {"minsw4", 			2,	0x3c,	0x6},
    {"minub8", 			2,	0x3c,	0x6},
    {"minuw4", 			2,	0x3c,	0x6},
    {"mskbl", 			1,	0x3e,	0x6},
    {"mskblimm", 		2,	0x3c,	0x6},
    {"msklh", 			1,	0x3e,	0x6},
    {"msklhimm", 		2,	0x3c,	0x6},
    {"mskll", 			1,	0x3e,	0x6},
    {"mskllimm", 		2,	0x3c,	0x6},
    {"mskqh", 			1,	0x3e,	0x6},
    {"mskqhimm", 		2,	0x3c,	0x6},
    {"mskql", 			1,	0x3e,	0x6},
    {"mskqlimm", 		2,	0x3c,	0x6},
    {"mskwh", 			1,	0x3e,	0x6},
    {"mskwhimm", 		2,	0x3c,	0x6},
    {"mskwl", 			1,	0x3e,	0x6},
    {"mskwlimm", 		2,	0x3c,	0x6},
    {"mt_fpcr", 		16,	0x38,	0x4},
    {"mull", 			1,	0x3e,	0x6},
    {"mullimm", 		2,	0x3c,	0x6},
    {"mullv", 			1,	0x3e,	0x6},
    {"mullvimm", 		2,	0x3c,	0x6},
    {"mulq", 			1,	0x3e,	0x6},
    {"mulqimm", 		2,	0x3c,	0x6},
    {"mulqv", 			1,	0x3e,	0x6},
    {"mulqvimm", 		2,	0x3c,	0x6},
    {"muls", 			1,	0x3e,	0x6},
    {"muls/su", 		1,	0x3e,	0x6},
    {"muls/sud", 		1,	0x3e,	0x6},
    {"mult", 			1,	0x3e,	0x6},
    {"mult/su", 		1,	0x3e,	0x6},
    {"mult/sud", 		1,	0x3e,	0x6},
    {"nop", 			20,	0x38,	0x4},
    {"ornot", 			1,	0x3e,	0x6},
    {"ornotimm", 		2,	0x3c,	0x6},
    {"perr", 			17,	0x3c,	0x4},
    {"pklb", 			17,	0x3c,	0x4},
    {"pkwb", 			17,	0x3c,	0x4},
    {"quiesce", 		17,	0x38,	0x4},
    {"quiescecycles", 		17,	0x38,	0x4},
    {"quiescens", 		17,	0x38,	0x4},
    {"quiescetime", 		17,	0x38,	0x4},
    {"rc", 			18,	0x38,	0x4},
    {"rduniq", 			18,	0x38,	0x4},
    {"resetstats", 		18,	0x38,	0x4},
    {"ret", 			9,	0x38,	0x4},
    {"retandlink", 		9,	0x38,	0x4},
    {"return", 			9,	0x38,	0x4},
    {"rpcc", 			19,	0x38,	0x4},
    {"rpns", 			19,	0x38,	0x4},
    {"rs", 			19,	0x38,	0x4},
    {"s4addl", 			1,	0x3e,	0x6},
    {"s4addlimm", 		2,	0x3c,	0x6},
    {"s4addq", 			1,	0x3e,	0x6},
    {"s4addqimm", 		2,	0x3c,	0x6},
    {"s4subl", 			1,	0x3e,	0x6},
    {"s4sublimm", 		2,	0x3c,	0x6},
    {"s4subq", 			1,	0x3e,	0x6},
    {"s4subqimm", 		2,	0x3c,	0x6},
    {"s8addl", 			1,	0x3e,	0x6},
    {"s8addlimm", 		2,	0x3c,	0x6},
    {"s8addq", 			1,	0x3e,	0x6},
    {"s8addqimm", 		2,	0x3c,	0x6},
    {"s8subl", 			1,	0x3e,	0x6},
    {"s8sublimm", 		2,	0x3c,	0x6},
    {"s8subq", 			1,	0x3e,	0x6},
    {"s8subqimm", 		2,	0x3c,	0x6},
    {"sextb", 			1,	0x3e,	0x6},
    {"sextbimm", 		2,	0x3c,	0x6},
    {"sextw", 			1,	0x3e,	0x6},
    {"sextwimm", 		2,	0x3c,	0x6},
    {"sll", 			1,	0x3e,	0x6},
    {"sllimm", 			2,	0x3c,	0x6},
    {"sqrts", 			2,	0x3c,	0x6},
    {"sqrtt", 			2,	0x3c,	0x6},
    {"sra", 			1,	0x3e,	0x6},
    {"sraimm", 			2,	0x3c,	0x6},
    {"srl", 			1,	0x3e,	0x6},
    {"srlimm", 			2,	0x3c,	0x6},
    {"stb", 			11,	0x3f,	0x5},
    {"stl", 			11,	0x3f,	0x5},
    {"stl_c", 			11,	0x3f,	0x5},
    {"stq", 			11,	0x3f,	0x5},
    {"stq_c", 			11,	0x3f,	0x5},
    {"stq_u", 			11,	0x3f,	0x5},
    {"sts", 			11,	0x3f,	0x5},
    {"stt", 			11,	0x3f,	0x5},
    {"stw", 			11,	0x3f,	0x5},
    {"subl", 			1,	0x3e,	0x6},
    {"sublimm", 		2,	0x3c,	0x6},
    {"sublv", 			1,	0x3e,	0x6},
    {"sublvimm", 		2,	0x3c,	0x6},
    {"subq", 			1,	0x3e,	0x6},
    {"subqimm", 		2,	0x3c,	0x6},
    {"subqv", 			1,	0x3e,	0x6},
    {"subqvimm", 		2,	0x3c,	0x6},
    {"subs", 			1,	0x3e,	0x6},
    {"subs/su", 		1,	0x3e,	0x6},
    {"subs/sud", 		1,	0x3e,	0x6},
    {"subs/sum", 		1,	0x3e,	0x6},
    {"subt", 			1,	0x3e,	0x6},
    {"subt/sud", 		1,	0x3e,	0x6},
    {"subt/sum", 		1,	0x3e,	0x6},
    {"trapb", 			20,	0x38,	0x6},
    {"umulh", 			1,	0x3e,	0x6},
    {"umulhimm", 		2,	0x3c,	0x6},
    {"unpkbl", 			1,	0x3e,	0x6},
    {"unpkbw", 			1,	0x3e,	0x6},
    {"wakecpu", 		20,	0x38,	0x6},
    {"wh64", 			20,	0x38,	0x6},
    {"wmb", 			20,	0x38,	0x6},
    {"wruniq", 			20,	0x38,	0x6},
    {"xor", 			1,	0x3e,	0x6},
    {"xorimm", 			2,	0x3c,	0x6},
    {"zap", 			1,	0x3e,	0x6},
    {"zapimm", 			2,	0x3c,	0x6},
    {"zapnot", 			1,	0x3e,	0x6},
    {"zapnotimm", 		2,	0x3c,	0x6},
    {NULL , 		 	21,	0x00,	0x0}
};

static int dict_size = -1;
void init_dict_size()
{
	dict_size = 0;
	while(dict[dict_size].opgrp > 0)
	{
		dict_size++;
	}
}

int isa_cmp(const void *key, const void * elem)
{
	//assert(dict_size>0);
	return strcmp((char *)key, ((struct isa *)elem)->str);
}

int opcodeToInt(char *key, unsigned int* opgrp, unsigned int* care, unsigned int* rescare)
{
	struct isa *match;

	assert(dict_size >= 0);

	match = bsearch(key,
			dict,
			dict_size,
			sizeof(struct isa),
			&isa_cmp);


	if(match)
	{
		*opgrp   = match->opgrp;
		*care    = match->care;
		*rescare = match->rescare;
		return 1;//match->n;
	}


	*opgrp   = -1;
	*care    = -1;
	*rescare = -1;

	return 0;
}
